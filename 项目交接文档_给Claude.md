# è€•åœ°è¯†åˆ«é¡¹ç›®äº¤æ¥æ–‡æ¡£ï¼ˆè¶…è¯¦ç»†ç‰ˆï¼‰

> **è­¦å‘Š**ï¼šè¿™ä¸ªé¡¹ç›®åæ ‡ç³»å¤„ç†æå…¶å¤æ‚ï¼Œå¿…é¡»å®Œå…¨ç†è§£åå†åŠ¨ä»£ç ï¼

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 è¿™æ˜¯ä»€ä¹ˆé¡¹ç›®ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ª**å†œä¸šé¥æ„Ÿå›¾åƒåˆ†æç³»ç»Ÿ**ï¼Œç”¨äºï¼š
1. è¯†åˆ«å«æ˜Ÿå›¾åƒä¸­çš„è€•åœ°åŒºåŸŸ
2. å¯¹æ¯”ä»Šå¹´å’Œå»å¹´çš„è€•åœ°å˜åŒ–
3. è®¡ç®—é¢ç§¯å˜åŒ–ï¼ˆå•ä½ï¼šäº©ï¼‰

### 1.2 æ ¸å¿ƒå·¥ä½œæµç¨‹

```
ç”¨æˆ·æ“ä½œï¼š
1. é€‰æ‹©"å»å¹´"TIFå›¾åƒï¼ˆæˆ–ä½¿ç”¨è®­ç»ƒæ—¶ä¿å­˜çš„åŸºå‡†æ•°æ®ï¼‰
2. é€‰æ‹©"ä»Šå¹´"TIFå›¾åƒ
3. ç‚¹å‡»"åˆ†æ"

ç³»ç»Ÿå¤„ç†ï¼š
1. è¯»å–ä»Šå¹´TIFçš„åœ°ç†èŒƒå›´ï¼ˆæŠ•å½±åæ ‡ï¼‰
2. ä»PKLåŸºå‡†æ•°æ®ä¸­è£å‰ªå¯¹åº”åŒºåŸŸçš„å»å¹´è€•åœ°æ©ç 
3. AIæ¨¡å‹è¯†åˆ«ä»Šå¹´å›¾åƒä¸­çš„è€•åœ°
4. è®¡ç®—é¢ç§¯å·®å¼‚
5. å¯è§†åŒ–å¯¹æ¯”ï¼ˆå·¦è¾¹å»å¹´é»„è‰²è½®å»“ï¼Œå³è¾¹ä»Šå¹´çº¢è‰²è½®å»“ï¼‰
```

### 1.3 æŠ€æœ¯æ ˆ

| ç»„ä»¶ | ç”¨é€” |
|-----|------|
| TensorFlow 2.x | æ·±åº¦å­¦ä¹ æ¡†æ¶ |
| U-Netæ¨¡å‹ | å›¾åƒåˆ†å‰²ï¼ˆè¯†åˆ«è€•åœ°ï¼‰ |
| Rasterio | è¯»å–TIFåœ°ç†å›¾åƒ |
| GeoPandas | è¯»å–SHPçŸ¢é‡æ–‡ä»¶ |
| PyProj | åæ ‡ç³»è½¬æ¢ |
| Affine | åœ°ç†å˜æ¢çŸ©é˜µ |
| OpenCV | å›¾åƒå¤„ç†ã€è½®å»“æ£€æµ‹ |
| Tkinter | å›¾å½¢ç•Œé¢ |

---

## äºŒã€æ–‡ä»¶ç»“æ„è¯¦è§£

```
python/
â”œâ”€â”€ è€•åœ°åˆ†æå·¥å…·_å›¾å½¢ç•Œé¢.py    # â˜… ä¸»ç¨‹åºï¼ˆç”¨æˆ·è¿è¡Œè¿™ä¸ªï¼‰
â”œâ”€â”€ è€•åœ°åˆ†æç³»ç»Ÿ.py            # â˜… åˆ†æå¼•æ“ï¼ˆè¢«GUIè°ƒç”¨ï¼‰
â”œâ”€â”€ è€•åœ°è¯†åˆ«æ¨¡å‹è®­ç»ƒ.py        # æ¨¡å‹è®­ç»ƒè„šæœ¬
â”œâ”€â”€ é‡æ–°ç”ŸæˆåŸºå‡†æ•°æ®.py        # é‡æ–°ç”ŸæˆPKL
â”œâ”€â”€ è€•åœ°è¯†åˆ«æ¨¡å‹.h5           # è®­ç»ƒå¥½çš„æ¨¡å‹æƒé‡
â””â”€â”€ è€•åœ°è¯†åˆ«æ¨¡å‹_åŸºå‡†æ•°æ®.pkl  # â˜…â˜…â˜… æ ¸å¿ƒï¼å»å¹´çš„è€•åœ°åŸºå‡†åœ°å›¾
```

### 2.1 è€•åœ°åˆ†æå·¥å…·_å›¾å½¢ç•Œé¢.pyï¼ˆä¸»ç¨‹åºï¼‰

**å…³é”®å‡½æ•°**ï¼š

| å‡½æ•°å | ä½œç”¨ | å…³é”®è¡Œå· |
|-------|------|----------|
| `é€‰æ‹©å»å¹´å›¾åƒ()` | é€‰æ‹©å»å¹´TIFæ–‡ä»¶ | çº¦250è¡Œ |
| `é€‰æ‹©ä»Šå¹´å›¾åƒ()` | é€‰æ‹©ä»Šå¹´TIFæ–‡ä»¶ | çº¦280è¡Œ |
| `æ‰§è¡Œåˆ†æ()` | æ ¸å¿ƒåˆ†æé€»è¾‘ | çº¦600-900è¡Œ |
| `æ˜¾ç¤ºè€•åœ°å¯è§†åŒ–()` | ç»˜åˆ¶è½®å»“å¯¹æ¯”å›¾ | çº¦400-580è¡Œ |

**æ‰§è¡Œåˆ†æ()çš„è¯¦ç»†æµç¨‹**ï¼š
```python
# 1. åŠ è½½PKLåŸºå‡†æ•°æ®
with open(åŸºå‡†æ•°æ®è·¯å¾„, 'rb') as f:
    åŸºå‡†ä¿¡æ¯ = pickle.load(f)

# 2. è¯»å–ä»Šå¹´TIFçš„åœ°ç†èŒƒå›´
with rasterio.open(ä»Šå¹´è·¯å¾„) as src:
    ä»Šå¹´_å·¦ = src.bounds.left
    ä»Šå¹´_å³ = src.bounds.right
    ä»Šå¹´_ä¸Š = src.bounds.top
    ä»Šå¹´_ä¸‹ = src.bounds.bottom
    ä»Šå¹´_crs = src.crs

# 3. åæ ‡ç³»è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰
# 4. è®¡ç®—äº¤é›†èŒƒå›´
# 5. ä»åŸºå‡†åœ°å›¾è£å‰ªå¯¹åº”åŒºåŸŸ
# 6. AIè¯†åˆ«ä»Šå¹´è€•åœ°
# 7. è®¡ç®—é¢ç§¯å˜åŒ–
# 8. è°ƒç”¨å¯è§†åŒ–å‡½æ•°
```

### 2.2 è€•åœ°è¯†åˆ«æ¨¡å‹_åŸºå‡†æ•°æ®.pklï¼ˆæ ¸å¿ƒæ•°æ®ï¼‰

è¿™ä¸ªæ–‡ä»¶ä¿å­˜äº†**å»å¹´çš„è€•åœ°èŒƒå›´**ï¼Œæ˜¯å¯¹æ¯”åˆ†æçš„åŸºå‡†ã€‚

**å®Œæ•´æ•°æ®ç»“æ„**ï¼š
```python
{
    # === å…ƒä¿¡æ¯ ===
    'ä¿å­˜æ—¶é—´': '2025-12-11 20:00:00',
    'åŸºå‡†å¹´ä»½': 'è®­ç»ƒæ•°æ®å¹´ä»½',
    'åŸºå‡†shpæ–‡ä»¶': 'é€šåŒ—å±€ç§æ¤ä½œç‰©.shp',
    'è®­ç»ƒå›¾åƒåˆ—è¡¨': ['tif1.tif', 'tif2.tif', ...],  # å“ªäº›TIFå‚ä¸äº†ç”Ÿæˆ
    
    # === æ ¸å¿ƒæ•°æ® ===
    'åŸºå‡†è€•åœ°åœ°å›¾': np.array,  # äºŒå€¼æ•°ç»„ï¼Œshape=(é«˜åº¦,å®½åº¦)ï¼Œ1=è€•åœ°ï¼Œ0=éè€•åœ°
    
    # === åœ°ç†å˜æ¢çŸ©é˜µï¼ˆAffine Transformï¼‰ ===
    'åœ°ç†å˜æ¢': {
        'a': 0.8,      # Xæ–¹å‘åˆ†è¾¨ç‡ï¼ˆç±³/åƒç´ ï¼‰ï¼Œæ­£å€¼
        'b': 0,        # æ—‹è½¬å‚æ•°ï¼Œé€šå¸¸ä¸º0
        'c': 592070.0, # å·¦ä¸Šè§’Xåæ ‡ï¼ˆæŠ•å½±åæ ‡ï¼ä¸æ˜¯ç»åº¦ï¼ï¼‰
        'd': 0,        # æ—‹è½¬å‚æ•°ï¼Œé€šå¸¸ä¸º0
        'e': -0.8,     # Yæ–¹å‘åˆ†è¾¨ç‡ï¼ˆç±³/åƒç´ ï¼‰ï¼Œè´Ÿå€¼ï¼å› ä¸ºYè½´å‘ä¸‹
        'f': 5340000.0 # å·¦ä¸Šè§’Yåæ ‡ï¼ˆæŠ•å½±åæ ‡ï¼ä¸æ˜¯çº¬åº¦ï¼ï¼‰
    },
    
    # === åæ ‡ç³»ä¿¡æ¯ ===
    'crs': 'EPSG:4551',  # æˆ–å®Œæ•´WKTå­—ç¬¦ä¸²
    'åƒç´ åˆ†è¾¨ç‡_ç±³': 0.8,
    
    # === è¦†ç›–èŒƒå›´ï¼ˆæŠ•å½±åæ ‡ï¼‰ ===
    # âš ï¸ è­¦å‘Šï¼šè¿™ä¸ªå­—æ®µå¯èƒ½ä¸å‡†ç¡®ï¼å¯èƒ½æ˜¯SHPçš„boundsè€Œä¸æ˜¯åŸºå‡†åœ°å›¾çš„çœŸå®èŒƒå›´ï¼
    'è¦†ç›–èŒƒå›´': {
        'å·¦': 592070.0,   # æœ€å°X
        'å³': 650000.0,   # æœ€å¤§X
        'ä¸Š': 5340000.0,  # æœ€å¤§Y
        'ä¸‹': 5280000.0   # æœ€å°Y
    }
}
```

---

## ä¸‰ã€åæ ‡ç³»ç»Ÿï¼ˆâ˜…â˜…â˜… æœ€é‡è¦ï¼å¿…é¡»ç†è§£ï¼ï¼‰

### 3.1 åŸºç¡€æ¦‚å¿µ

**è¿™ä¸ªé¡¹ç›®æ¶‰åŠä¸‰ç§åæ ‡**ï¼š

| åæ ‡ç±»å‹ | å•ä½ | ç¤ºä¾‹ | ç”¨é€” |
|---------|------|------|------|
| åƒç´ åæ ‡ | åƒç´  | (100, 200) | æ•°ç»„ç´¢å¼• |
| æŠ•å½±åæ ‡ | ç±³ | (594823.56, 5331172.02) | TIFæ–‡ä»¶å­˜å‚¨çš„åæ ‡ |
| ç»çº¬åº¦ | åº¦ | (127.27Â°, 48.11Â°) | äººç±»å¯è¯»çš„åæ ‡ |

### 3.2 é¡¹ç›®ä½¿ç”¨çš„åæ ‡ç³»

**CGCS2000 / 3-degree Gauss-Kruger**ï¼š
- ä¸­å›½2000å¤§åœ°åæ ‡ç³»çš„é«˜æ–¯-å…‹å•æ ¼æŠ•å½±
- æŒ‰ä¸­å¤®ç»çº¿åˆ†å¸¦ï¼ˆæ¯3åº¦ä¸€ä¸ªå¸¦ï¼‰

| EPSGä»£ç  | ä¸­å¤®ç»çº¿ | è¦†ç›–åŒºåŸŸ |
|----------|---------|----------|
| EPSG:4551 | 126Â°E | ç»åº¦124.5Â°~127.5Â° |
| EPSG:4552 | 129Â°E | ç»åº¦127.5Â°~130.5Â° |

**é‡è¦**ï¼šé¡¹ç›®åŒºåŸŸåœ¨ç»åº¦127Â°é™„è¿‘ï¼Œå¯èƒ½åŒæ—¶æ¶‰åŠä¸¤ä¸ªåæ ‡ç³»ï¼

### 3.3 åæ ‡è½¬æ¢ä»£ç 

```python
from pyproj import Transformer, CRS

# === æŠ•å½±åæ ‡ â†’ ç»çº¬åº¦ ===
def æŠ•å½±è½¬ç»çº¬åº¦(x, y, crs_str):
    transformer = Transformer.from_crs(crs_str, 'EPSG:4326', always_xy=True)
    lon, lat = transformer.transform(x, y)
    return lon, lat

# ç¤ºä¾‹
ç»åº¦, çº¬åº¦ = æŠ•å½±è½¬ç»çº¬åº¦(594823.56, 5331172.02, 'EPSG:4551')
# ç»“æœï¼šç»åº¦â‰ˆ127.27Â°, çº¬åº¦â‰ˆ48.11Â°

# === ç»çº¬åº¦ â†’ æŠ•å½±åæ ‡ ===
def ç»çº¬åº¦è½¬æŠ•å½±(lon, lat, target_crs):
    transformer = Transformer.from_crs('EPSG:4326', target_crs, always_xy=True)
    x, y = transformer.transform(lon, lat)
    return x, y

# === ä¸åŒæŠ•å½±ä¹‹é—´è½¬æ¢ ===
def æŠ•å½±è½¬æŠ•å½±(x, y, from_crs, to_crs):
    transformer = Transformer.from_crs(from_crs, to_crs, always_xy=True)
    new_x, new_y = transformer.transform(x, y)
    return new_x, new_y
```

### 3.4 åœ°ç†å˜æ¢çŸ©é˜µï¼ˆAffine Transformï¼‰

ç”¨äº**åƒç´ åæ ‡**å’Œ**æŠ•å½±åæ ‡**ä¹‹é—´çš„è½¬æ¢ã€‚

```python
from affine import Affine

# === ä»PKLé‡å»ºå˜æ¢çŸ©é˜µ ===
åœ°ç†å˜æ¢ = åŸºå‡†ä¿¡æ¯['åœ°ç†å˜æ¢']
transform = Affine(
    åœ°ç†å˜æ¢['a'], åœ°ç†å˜æ¢['b'], åœ°ç†å˜æ¢['c'],
    åœ°ç†å˜æ¢['d'], åœ°ç†å˜æ¢['e'], åœ°ç†å˜æ¢['f']
)

# === åƒç´ åæ ‡ â†’ æŠ•å½±åæ ‡ ===
# æ³¨æ„ï¼š(col, row) ä¸æ˜¯ (row, col)ï¼
x_proj, y_proj = transform * (col, row)

# === æŠ•å½±åæ ‡ â†’ åƒç´ åæ ‡ ===
# ä½¿ç”¨é€†å˜æ¢ ~transform
col, row = ~transform * (x_proj, y_proj)

# === â˜…â˜…â˜… è®¡ç®—åŸºå‡†åœ°å›¾çš„çœŸå®è¦†ç›–èŒƒå›´ ===
# å…³é”®ï¼ä¸è¦ç›´æ¥ç”¨PKLä¸­çš„'è¦†ç›–èŒƒå›´'ï¼Œå¯èƒ½ä¸å‡†ç¡®ï¼
h, w = åŸºå‡†ä¿¡æ¯['åŸºå‡†è€•åœ°åœ°å›¾'].shape
çœŸå®_å·¦ = åœ°ç†å˜æ¢['c']                      # å·¦ä¸Šè§’X
çœŸå®_ä¸Š = åœ°ç†å˜æ¢['f']                      # å·¦ä¸Šè§’Y
çœŸå®_å³ = çœŸå®_å·¦ + w * åœ°ç†å˜æ¢['a']        # å³è¾¹ç•Œ = å·¦ + å®½åº¦*Xåˆ†è¾¨ç‡
çœŸå®_ä¸‹ = çœŸå®_ä¸Š + h * åœ°ç†å˜æ¢['e']        # ä¸‹è¾¹ç•Œ = ä¸Š + é«˜åº¦*Yåˆ†è¾¨ç‡ï¼ˆeæ˜¯è´Ÿå€¼ï¼ï¼‰
```

### 3.5 äº¤é›†åˆ¤æ–­å®Œæ•´æµç¨‹

```python
def è®¡ç®—äº¤é›†(ä»Šå¹´è·¯å¾„, åŸºå‡†ä¿¡æ¯):
    import rasterio
    from pyproj import Transformer
    
    with rasterio.open(ä»Šå¹´è·¯å¾„) as src:
        ä»Šå¹´_å·¦, ä»Šå¹´_ä¸‹, ä»Šå¹´_å³, ä»Šå¹´_ä¸Š = src.bounds
        ä»Šå¹´_crs = src.crs
    
    # ä»åœ°ç†å˜æ¢è®¡ç®—åŸºå‡†åœ°å›¾çœŸå®èŒƒå›´ï¼ˆä¸è¦ç”¨è¦†ç›–èŒƒå›´å­—æ®µï¼ï¼‰
    åœ°ç†å˜æ¢ = åŸºå‡†ä¿¡æ¯['åœ°ç†å˜æ¢']
    åŸºå‡†åœ°å›¾ = åŸºå‡†ä¿¡æ¯['åŸºå‡†è€•åœ°åœ°å›¾']
    h, w = åŸºå‡†åœ°å›¾.shape
    
    åŸºå‡†_å·¦ = åœ°ç†å˜æ¢['c']
    åŸºå‡†_ä¸Š = åœ°ç†å˜æ¢['f']
    åŸºå‡†_å³ = åŸºå‡†_å·¦ + w * åœ°ç†å˜æ¢['a']
    åŸºå‡†_ä¸‹ = åŸºå‡†_ä¸Š + h * åœ°ç†å˜æ¢['e']
    åŸºå‡†_crs = åŸºå‡†ä¿¡æ¯['crs']
    
    # åæ ‡ç³»è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰- é€šè¿‡WGS84ä¸­è½¬
    # ...
    
    # è®¡ç®—äº¤é›†
    äº¤é›†_å·¦ = max(ä»Šå¹´_å·¦, åŸºå‡†_å·¦)
    äº¤é›†_å³ = min(ä»Šå¹´_å³, åŸºå‡†_å³)
    äº¤é›†_ä¸‹ = max(ä»Šå¹´_ä¸‹, åŸºå‡†_ä¸‹)
    äº¤é›†_ä¸Š = min(ä»Šå¹´_ä¸Š, åŸºå‡†_ä¸Š)
    
    æœ‰äº¤é›† = (äº¤é›†_å³ > äº¤é›†_å·¦) and (äº¤é›†_ä¸Š > äº¤é›†_ä¸‹)
    return æœ‰äº¤é›†, (äº¤é›†_å·¦, äº¤é›†_å³, äº¤é›†_ä¸‹, äº¤é›†_ä¸Š)
```

---

## å››ã€é¢ç§¯è®¡ç®—è¯¦è§£

### 4.1 åŸºæœ¬å…¬å¼

```
é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰ = è€•åœ°åƒç´ æ•° Ã— å•åƒç´ é¢ç§¯
å•åƒç´ é¢ç§¯ = Xåˆ†è¾¨ç‡ Ã— Yåˆ†è¾¨ç‡
é¢ç§¯ï¼ˆäº©ï¼‰ = é¢ç§¯ï¼ˆå¹³æ–¹ç±³ï¼‰ / 666.67
```

### 4.2 è·å–åƒç´ åˆ†è¾¨ç‡

```python
import rasterio

with rasterio.open(tifè·¯å¾„) as src:
    xåˆ†è¾¨ç‡ = abs(src.transform.a)  # ç±³/åƒç´ 
    yåˆ†è¾¨ç‡ = abs(src.transform.e)  # ç±³/åƒç´ ï¼ˆeé€šå¸¸æ˜¯è´Ÿå€¼ï¼‰
    å•åƒç´ é¢ç§¯ = xåˆ†è¾¨ç‡ * yåˆ†è¾¨ç‡  # å¹³æ–¹ç±³
```

### 4.3 â˜… å»å¹´é¢ç§¯è®¡ç®—çš„å‘

**é—®é¢˜**ï¼šå»å¹´çš„æ©ç æ˜¯ä»åŸºå‡†åœ°å›¾è£å‰ªçš„ï¼Œåˆ†è¾¨ç‡å¯èƒ½ä¸ä»Šå¹´ä¸åŒï¼

```python
# âŒ é”™è¯¯åšæ³•ï¼šç”¨ä»Šå¹´çš„åˆ†è¾¨ç‡è®¡ç®—å»å¹´é¢ç§¯
å»å¹´_é¢ç§¯ = np.sum(å»å¹´æ©ç ) * ä»Šå¹´_åˆ†è¾¨ç‡**2  # é”™ï¼

# âœ… æ­£ç¡®åšæ³•ï¼šç”¨åŸºå‡†åœ°å›¾çš„åˆ†è¾¨ç‡è®¡ç®—å»å¹´é¢ç§¯
åŸºå‡†_åˆ†è¾¨ç‡ = åŸºå‡†ä¿¡æ¯['åƒç´ åˆ†è¾¨ç‡_ç±³']
å»å¹´_é¢ç§¯_å¹³æ–¹ç±³ = np.sum(è£å‰ªåŒºåŸŸ) * (åŸºå‡†_åˆ†è¾¨ç‡ ** 2)
å»å¹´_é¢ç§¯_äº© = å»å¹´_é¢ç§¯_å¹³æ–¹ç±³ / 666.67
```

---

## äº”ã€å¸¸è§é—®é¢˜å®Œæ•´è§£å†³æ–¹æ¡ˆ

### 5.1 "æ— äº¤é›†"é”™è¯¯

**ç—‡çŠ¶**ï¼šæç¤º"ä»Šå¹´å›¾åƒä¸å»å¹´åŸºå‡†åœ°å›¾æ²¡æœ‰äº¤é›†"

**å¯èƒ½åŸå› **ï¼š

| åŸå›  | æ£€æŸ¥æ–¹æ³• | è§£å†³æ–¹æ¡ˆ |
|-----|----------|----------|
| PKLåªè¦†ç›–éƒ¨åˆ†TIF | æ‰“å°åŸºå‡†èŒƒå›´å’Œä»Šå¹´èŒƒå›´ | è¿è¡Œ `é‡æ–°ç”ŸæˆåŸºå‡†æ•°æ®.py` |
| ä½¿ç”¨äº†é”™è¯¯çš„è¦†ç›–èŒƒå›´ | æ£€æŸ¥æ˜¯å¦ç”¨äº†PKLçš„'è¦†ç›–èŒƒå›´'å­—æ®µ | ç”¨åœ°ç†å˜æ¢è®¡ç®—çœŸå®èŒƒå›´ |
| åæ ‡ç³»è½¬æ¢é”™è¯¯ | æ‰“å°è½¬æ¢å‰åçš„åæ ‡ | æ£€æŸ¥CRSæ˜¯å¦æ­£ç¡®è¯†åˆ« |

**è°ƒè¯•ä»£ç **ï¼š
```python
print(f"ä»Šå¹´èŒƒå›´: X[{ä»Šå¹´_å·¦:.2f}~{ä»Šå¹´_å³:.2f}] Y[{ä»Šå¹´_ä¸‹:.2f}~{ä»Šå¹´_ä¸Š:.2f}]")
print(f"åŸºå‡†èŒƒå›´: X[{åŸºå‡†_å·¦:.2f}~{åŸºå‡†_å³:.2f}] Y[{åŸºå‡†_ä¸‹:.2f}~{åŸºå‡†_ä¸Š:.2f}]")
print(f"ä»Šå¹´CRS: {ä»Šå¹´_crs}")
print(f"åŸºå‡†CRS: {åŸºå‡†_crs}")
```

### 5.2 OpenCV resizeç©ºæ•°ç»„é”™è¯¯

**ç—‡çŠ¶**ï¼š`cv2.error: !ssize.empty()`

**è§£å†³**ï¼šåœ¨resizeå‰æ£€æŸ¥
```python
if æ•°ç»„.size == 0 or æ•°ç»„.shape[0] == 0 or æ•°ç»„.shape[1] == 0:
    print(f"è­¦å‘Šï¼šæ•°ç»„ä¸ºç©ºï¼Œshape={æ•°ç»„.shape}")
    return

if row_min >= row_max or col_min >= col_max:
    print(f"è­¦å‘Šï¼šè£å‰ªèŒƒå›´æ— æ•ˆ")
    return
```

### 5.3 ä¸­å¤®ç»çº¿è§£æå¤±è´¥

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º `ä»Šå¹´ä¸­å¤®ç»çº¿: CM E` ï¼ˆåº”è¯¥æ˜¯ `CM 129E`ï¼‰

**åŸå› **ï¼šæ­£åˆ™è¡¨è¾¾å¼è§£æCRSå­—ç¬¦ä¸²æ—¶ä¸¢å¤±äº†æ•°å­—

**è§£å†³**ï¼šæ”¹ç”¨æ›´å¯é çš„è§£ææ–¹æ³•
```python
import re
def æå–ä¸­å¤®ç»çº¿(crs_str):
    patterns = [
        r'CM\s*(\d+)E',
        r'central_meridian.*?(\d+)',
        r'CM_(\d+)E',
    ]
    for pattern in patterns:
        match = re.search(pattern, crs_str, re.IGNORECASE)
        if match:
            return int(match.group(1))
    return None
```

### 5.4 é»‘è‰²åŒºåŸŸç”»è½®å»“

**è§£å†³**ï¼šè¿‡æ»¤é»‘è‰²åŒºåŸŸ
```python
é»‘è‰²æ©ç  = (å›¾åƒ[:,:,0] < 5) & (å›¾åƒ[:,:,1] < 5) & (å›¾åƒ[:,:,2] < 5)
è€•åœ°æ©ç [é»‘è‰²æ©ç ] = 0
```

### 5.5 è½®å»“ä¸é—­åˆ

**è§£å†³**ï¼šç”¨polylinesæ›¿ä»£drawContours
```python
cv2.polylines(å›¾åƒ, [è½®å»“], isClosed=True, color=(0,255,255), thickness=4)
```

---

## å…­ã€ç”¨æˆ·åå¥½ï¼ˆâ˜… å¿…é¡»éµå®ˆï¼ï¼‰

| åå¥½ | è¯´æ˜ |
|-----|------|
| ä¸€æ¬¡æ€§è§£å†³ | ç”¨æˆ·è®¨åŒåŒä¸€é—®é¢˜åå¤å‡ºç°ï¼Œå¿…é¡»å½»åº•ä¿®å¤ |
| è¿è¡ŒéªŒè¯ | ç”¨æˆ·å–œæ¬¢ç›´æ¥è¿è¡Œä»£ç çœ‹ç»“æœï¼Œä¸å–œæ¬¢ç†è®ºè§£é‡Š |
| ç¦æ­¢è‡ªåŠ¨ç”Ÿæˆ | ä¸è¦è‡ªä½œä¸»å¼ æ‰¹é‡ç”Ÿæˆæ•°æ®ï¼Œå¿…é¡»ç”¨æˆ·æ˜ç¡®è¦æ±‚ |
| åŸºäºå·²æœ‰ä¼˜åŒ– | åœ¨ç°æœ‰ä»£ç ä¸Šä¿®æ”¹ï¼Œä¸è¦é‡æ–°åˆ›å»º |
| å¯è§†åŒ–ä¼˜å…ˆ | è°ƒè¯•æ—¶å…ˆå±•ç¤ºå¯è§†åŒ–ç»“æœ |
| ç•Œé¢å±•ç¤º | åˆ†æç»“æœæ˜¾ç¤ºåœ¨GUIä¸­ï¼Œä¸è¦é™é»˜ä¿å­˜CSV |
| ç¦æ­¢ä¼šè¯å‹ç¼© | ä¿æŒå®Œæ•´å¯¹è¯å†å² |

---

## ä¸ƒã€è®­ç»ƒæ•°æ®é…ç½®

| é…ç½®é¡¹ | å€¼ |
|-------|-----|
| TIFç›®å½• | `E:\å…«äºŒ\20250420é€šåŒ—å…«äºŒ2_3` |
| TIFæ•°é‡ | 14ä¸ªï¼Œæ¯ä¸ªçº¦10GB |
| SHPæ–‡ä»¶ | `E:\é€šåŒ—å±€ç§æ¤ä½œç‰©\é€šåŒ—å±€ç§æ¤ä½œç‰©.shp` |
| æ¨¡å¼ | å•SHPå¤šTIFï¼ˆä¸€ä¸ªå¤§SHPè¦†ç›–æ‰€æœ‰TIFï¼‰ |
| åŸºå‡†åæ ‡ç³» | EPSG:4551ï¼ˆä¸­å¤®ç»çº¿126Â°Eï¼‰ |
| SHPåæ ‡ç³» | å¯èƒ½æ˜¯EPSG:4552ï¼ˆä¸­å¤®ç»çº¿129Â°Eï¼‰ |

---

## å…«ã€è°ƒè¯•æ¨¡æ¿

```python
print("="*50)
print("ğŸ” åæ ‡è°ƒè¯•ä¿¡æ¯")
print("="*50)
print(f"ä»Šå¹´èŒƒå›´: X[{ä»Šå¹´_å·¦:.2f}~{ä»Šå¹´_å³:.2f}] Y[{ä»Šå¹´_ä¸‹:.2f}~{ä»Šå¹´_ä¸Š:.2f}]")
print(f"åŸºå‡†èŒƒå›´: X[{åŸºå‡†_å·¦:.2f}~{åŸºå‡†_å³:.2f}] Y[{åŸºå‡†_ä¸‹:.2f}~{åŸºå‡†_ä¸Š:.2f}]")
print(f"ä»Šå¹´CRS: {ä»Šå¹´_crs}")
print(f"åŸºå‡†CRS: {åŸºå‡†_crs}")

# è½¬æ¢ä¸ºç»çº¬åº¦
from pyproj import Transformer
trans = Transformer.from_crs(ä»Šå¹´_crs, 'EPSG:4326', always_xy=True)
lon1, lat1 = trans.transform(ä»Šå¹´_å·¦, ä»Šå¹´_ä¸‹)
lon2, lat2 = trans.transform(ä»Šå¹´_å³, ä»Šå¹´_ä¸Š)
print(f"ä»Šå¹´ç»çº¬åº¦: ({lon1:.6f}Â°~{lon2:.6f}Â°, {lat1:.6f}Â°~{lat2:.6f}Â°)")
```

---

## ä¹ã€å¿«é€Ÿä¿®å¤æ¸…å•

é‡åˆ°é—®é¢˜æ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

1. âœ… **PKLæ˜¯å¦è¦†ç›–æµ‹è¯•åŒºåŸŸ** - è¿è¡Œ `é‡æ–°ç”ŸæˆåŸºå‡†æ•°æ®.py`
2. âœ… **åæ ‡ç³»æ˜¯å¦åŒ¹é…** - æ‰“å°ä»Šå¹´CRSå’ŒåŸºå‡†CRS
3. âœ… **æ˜¯å¦ç”¨äº†æ­£ç¡®çš„è¦†ç›–èŒƒå›´** - ç”¨åœ°ç†å˜æ¢è®¡ç®—ï¼Œä¸ç”¨PKLçš„'è¦†ç›–èŒƒå›´'å­—æ®µ
4. âœ… **è£å‰ªèŒƒå›´æ˜¯å¦æœ‰æ•ˆ** - row_min < row_max, col_min < col_max
5. âœ… **æ•°ç»„æ˜¯å¦ä¸ºç©º** - resizeå‰æ£€æŸ¥shape
6. âœ… **åˆ†è¾¨ç‡æ˜¯å¦æ­£ç¡®** - å»å¹´ç”¨åŸºå‡†åˆ†è¾¨ç‡ï¼Œä»Šå¹´ç”¨TIFåˆ†è¾¨ç‡

---

**å®Œæˆæ—¥æœŸ**ï¼š2025-12-15  
**ç¼–å†™è€…**ï¼šQoder  
**ç›®çš„**ï¼šäº¤æ¥ç»™å…¶ä»–AIç»§ç»­å¤„ç†  
**ç‰ˆæœ¬**ï¼šv2.0 è¶…è¯¦ç»†ç‰ˆ
